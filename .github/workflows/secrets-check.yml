name: Secrets Check

on:
  pull_request:
  push:
    branches: [main, develop]

jobs:
  secrets-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Run truffleHog to detect secrets
        uses: trufflesecurity/trufflehog@main
        with:
          path: ./
          base: ${{ github.event.repository.default_branch }}
          head: HEAD
          extra_args: --debug --only-verified

      - name: Check for .env file
        run: |
          if [ -f .env ]; then
            echo "❌ ERROR: .env file should not be committed"
            echo "Add .env to .gitignore and remove from git history:"
            echo "  git rm -r --cached .env"
            echo "  git commit -m 'remove .env'"
            exit 1
          fi
          echo "✓ .env file not in repository"

      - name: Verify .env.example exists
        run: |
          if [ ! -f .env.example ]; then
            echo "❌ ERROR: .env.example template not found"
            exit 1
          fi
          echo "✓ .env.example template exists"
